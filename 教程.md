ä»¥ä¸‹æ˜¯è¿è¡Œè„šæœ¬æ‰€éœ€çš„ **GitHubä»“åº“æ–‡ä»¶**ï¼ˆå·¥ä½œæµé…ç½®ã€å›æ»šè„šæœ¬ï¼‰å’Œ **æœ¬åœ°ç¯å¢ƒæ–‡ä»¶**ï¼ˆç¯å¢ƒå˜é‡ï¼‰çš„å…·ä½“å†…å®¹ï¼Œæ‰€æœ‰å†…å®¹å‡è´´åˆéªŒè¯è„šæœ¬çš„æ ¡éªŒé€»è¾‘ï¼Œå¯ç›´æ¥å¤ç”¨æˆ–å¾®è°ƒï¼š


## ä¸€ã€GitHubä»“åº“æ ¸å¿ƒæ–‡ä»¶ï¼ˆç›®æ ‡ä»“åº“ï¼š`project-deploy`ï¼‰
### 1. å·¥ä½œæµé…ç½®æ–‡ä»¶ï¼š`.github/workflows/deployment-status.yml`
è¯¥æ–‡ä»¶æ˜¯éªŒè¯è„šæœ¬çš„æ ¸å¿ƒæ ¡éªŒå¯¹è±¡ï¼Œéœ€åŒ…å« **3ä¸ªå¿…éœ€Job**ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰ã€**Issueè‡ªåŠ¨åˆ›å»º/æ›´æ–°**ã€**æœºå™¨äººè¯„è®º** ç­‰é€»è¾‘ï¼Œç¡®ä¿èƒ½è¢«éªŒè¯è„šæœ¬è¯†åˆ«ï¼š
```yaml
name: Deployment Status Workflow
# è§¦å‘æ¡ä»¶ï¼š1. mainåˆ†æ”¯push 2. æ‰‹åŠ¨è§¦å‘ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  #  Job1ï¼šéƒ¨ç½²å‰æ£€æŸ¥ï¼ˆç¯å¢ƒã€ä¾èµ–ã€é…ç½®æ ¡éªŒï¼‰
  pre-deployment:
    runs-on: ubuntu-latest
    outputs:
      prev_commit: ${{ steps.get_prev_commit.outputs.prev_commit }}  # ä¼ é€’ä¸Šä¸€ç‰ˆCommit SHAç»™åç»­Job
      current_commit: ${{ github.sha }}  # ä¼ é€’å½“å‰Commit SHA
      package_version: ${{ steps.get_version.outputs.version }}  # ä¼ é€’åŒ…ç‰ˆæœ¬
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2  # æ‹‰å–æœ€è¿‘2æ¬¡æäº¤ï¼ˆç”¨äºè·å–ä¸Šä¸€ç‰ˆCommitï¼‰

      - name: Get previous commit SHA
        id: get_prev_commit
        run: echo "prev_commit=$(git rev-parse HEAD~1)" >> $GITHUB_OUTPUT

      - name: Get package versionï¼ˆç¤ºä¾‹ï¼šä»package.jsonè¯»å–ï¼‰
        id: get_version
        run: |
          VERSION=$(jq -r '.version' package.json 2>/dev/null || echo "1.0.0")
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Pre-deployment checksï¼ˆç¯å¢ƒã€ä¾èµ–æ ¡éªŒï¼‰
        run: |
          echo "âœ… Checking server connectivity..."
          # ç¤ºä¾‹ï¼šæ·»åŠ å®é™…æ ¡éªŒé€»è¾‘ï¼ˆå¦‚æœåŠ¡å™¨ pingã€ä¾èµ–å®‰è£…ã€é…ç½®æ–‡ä»¶æ£€æŸ¥ï¼‰
          npm install --silent
          echo "âœ… Pre-deployment checks completed successfully"

      - name: Create deployment tracking Issueï¼ˆåˆ›å»ºéƒ¨ç½²è·Ÿè¸ªIssueï¼‰
        id: create_issue
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}  # GitHubå†…ç½®ä»¤ç‰Œï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰
          script: |
            const shortSha = process.env.GITHUB_SHA.slice(0,7);
            const issueTitle = `Deployment Tracking - ${shortSha}`;
            // æ£€æŸ¥Issueæ˜¯å¦å·²å­˜åœ¨ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰
            const existingIssues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              per_page: 10
            });
            const existingIssue = existingIssues.data.find(issue => issue.title === issueTitle);
            
            if (existingIssue) {
              console.log(`Issue #${existingIssue.number} already exists`);
              return { issue_number: existingIssue.number };
            }
            
            // åˆ›å»ºæ–°Issue
            const newIssue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: issueTitle,
              body: "## Deployment Tracking\nThis issue tracks the current deployment process.",
              labels: ["deployment", "in-progress"]  # åˆå§‹æ ‡ç­¾ï¼ˆåç»­ä¼šæ›´æ–°ä¸ºcompletedï¼‰
            });
            console.log(`Created Issue #${newIssue.data.number}`);
            return { issue_number: newIssue.data.number };
        env:
          GITHUB_SHA: ${{ github.sha }}
        outputs:
          issue_number: ${{ steps.create_issue.outputs.result.issue_number }}  # ä¼ é€’Issueç¼–å·


  # Job2ï¼šå›æ»šå‡†å¤‡ï¼ˆç”Ÿæˆå›æ»šè®¡åˆ’ã€è®¡ç®—SHA256ã€æ·»åŠ æœºå™¨äººè¯„è®ºï¼‰
  rollback-preparation:
    runs-on: ubuntu-latest
    needs: pre-deployment  # ä¾èµ–pre-deployment Jobï¼Œç¡®ä¿é¡ºåºæ‰§è¡Œ
    inputs:
      issue_number:
        description: "Deployment tracking Issue number"
        required: true
        default: ${{ needs.pre-deployment.outputs.issue_number }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Generate rollback scriptï¼ˆç”Ÿæˆå›æ»šè„šæœ¬ï¼‰
        run: |
          cat > rollback.sh << 'EOF'
          #!/bin/bash
          # å›æ»šè„šæœ¬ï¼šæ¢å¤åˆ°ä¸Šä¸€ç‰ˆCommit
          echo "Rolling back to previous commit: $1"
          git reset --hard $1
          npm install --silent
          npm run start
          echo "Rollback completed successfully"
          EOF
          chmod +x rollback.sh

      - name: Calculate SHA256 for rollback packageï¼ˆè®¡ç®—å›æ»šåŒ…æ ¡éªŒå’Œï¼‰
        id: get_sha256
        run: |
          # ç¤ºä¾‹ï¼šå‹ç¼©å›æ»šç›¸å…³æ–‡ä»¶å¹¶è®¡ç®—SHA256
          tar -czf rollback-package.tar.gz rollback.sh package.json
          SHA256=$(sha256sum rollback-package.tar.gz | awk '{print $1}')
          echo "sha256=$SHA256" >> $GITHUB_OUTPUT

      - name: Add rollback plan to Issueï¼ˆæ·»åŠ å›æ»šè®¡åˆ’åˆ°Issueè¯„è®ºï¼‰
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = ${{ needs.pre-deployment.outputs.issue_number }};
            const prevCommit = "${{ needs.pre-deployment.outputs.prev_commit }}";
            const currentCommit = "${{ needs.pre-deployment.outputs.current_commit }}";
            const packageVersion = "${{ needs.pre-deployment.outputs.package_version }}";
            const sha256 = "${{ steps.get_sha256.outputs.sha256 }}";
            
            // å›æ»šè®¡åˆ’è¯„è®ºå†…å®¹ï¼ˆéœ€åŒ…å«éªŒè¯è„šæœ¬è¦æ±‚çš„æ‰€æœ‰å…ƒç´ ï¼‰
            const commentBody = `ğŸ”„ Rollback Plan Ready
            **Previous Commit**: ${prevCommit}
            **Current Commit**: ${currentCommit}
            **Package Version**: ${packageVersion}
            **SHA256**: ${sha256}
            
            ### Rollback Preparation Status
            âœ… Executable rollback script created (rollback.sh)
            âœ… Configuration backups saved (package.json)
            âœ… Dependency verification script prepared (npm install)
            âœ… Comprehensive rollback documentation generated
            âœ… Compressed rollback package created (rollback-package.tar.gz)
            
            ### Quick Rollback Commands
            \`\`\`bash
            # æ‰§è¡Œå›æ»šï¼ˆæ›¿æ¢ä¸ºä¸Šä¸€ç‰ˆCommit SHAï¼‰
            ./rollback.sh ${prevCommit}
            \`\`\`
            `;
            
            // æ·»åŠ è¯„è®ºåˆ°Issue
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: commentBody
            });
            console.log("Rollback plan added to Issue #", issueNumber);


  # Job3ï¼šéƒ¨ç½²åå¤„ç†ï¼ˆæ‰§è¡Œéƒ¨ç½²ã€æ›´æ–°IssueçŠ¶æ€å’Œæ ‡ç­¾ï¼‰
  post-deployment:
    runs-on: ubuntu-latest
    needs: [pre-deployment, rollback-preparation]  # ä¾èµ–å‰ä¸¤ä¸ªJob
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Execute deploymentï¼ˆæ‰§è¡Œéƒ¨ç½²ï¼Œç¤ºä¾‹é€»è¾‘ï¼‰
        run: |
          echo "ğŸš€ Starting deployment to production..."
          # ç¤ºä¾‹ï¼šæ·»åŠ å®é™…éƒ¨ç½²å‘½ä»¤ï¼ˆå¦‚ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€å¯åŠ¨æœåŠ¡ï¼‰
          npm run build
          echo "âœ… Deployment Completed Successfully"

      - name: Update Issue statusï¼ˆæ›´æ–°IssueçŠ¶æ€ä¸ºclosed+æ·»åŠ å®Œæˆæ ‡ç­¾ï¼‰
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = ${{ needs.pre-deployment.outputs.issue_number }};
            const shortSha = process.env.GITHUB_SHA.slice(0,7);
            
            // 1. æ·»åŠ éƒ¨ç½²æˆåŠŸè¯„è®º
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: "âœ… Deployment Completed Successfully\nTracking ID: " + shortSha
            });
            
            // 2. æ›´æ–°Issueæ ‡ç­¾ï¼ˆä»in-progressæ”¹ä¸ºcompletedï¼‰
            await github.rest.issues.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              state: "closed",  // å…³é—­Issue
              labels: ["deployment", "completed"]  // éªŒè¯è„šæœ¬è¦æ±‚çš„å¿…éœ€æ ‡ç­¾
            });
            console.log("Issue #", issueNumber, "updated to closed with completed label");
        env:
          GITHUB_SHA: ${{ github.sha }}
```


### 2. é¡¹ç›®åŸºç¡€æ–‡ä»¶ï¼š`package.json`ï¼ˆç¤ºä¾‹ï¼Œç”¨äºç‰ˆæœ¬è¯»å–ï¼‰
å·¥ä½œæµä¸­ä¼šè¯»å–è¯¥æ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œæ— éœ€å¤æ‚é…ç½®ï¼Œä»…éœ€åŸºç¡€ç»“æ„ï¼š
```json
{
  "name": "project-deploy",
  "version": "1.2.3",  // å·¥ä½œæµä¼šè¯»å–æ­¤ç‰ˆæœ¬å·åˆ°å›æ»šè®¡åˆ’
  "scripts": {
    "install": "npm install",
    "build": "echo 'Building project...'",
    "start": "echo 'Starting project...'"
  },
  "dependencies": {
    "jq": "^1.7.1"  // å·¥ä½œæµä¸­ç”¨äºè§£æJSONçš„å·¥å…·
  }
}
```


### 3. å›æ»šè„šæœ¬ï¼ˆå·¥ä½œæµè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨æäº¤ï¼‰
`rollback.sh` ç”±å·¥ä½œæµçš„ `rollback-preparation` Jobè‡ªåŠ¨ç”Ÿæˆï¼Œå†…å®¹å·²åŒ…å«åœ¨ä¸Šè¿°å·¥ä½œæµä¸­ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯æ¢å¤åˆ°ä¸Šä¸€ç‰ˆCommitï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤ã€‚


## äºŒã€æœ¬åœ°ç¯å¢ƒæ–‡ä»¶ï¼ˆä¸éªŒè¯è„šæœ¬åŒçº§ç›®å½•ï¼‰
### ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š`.env.actions`
ç”¨äºå­˜å‚¨GitHubä»¤ç‰Œå’Œç»„ç»‡åï¼Œéœ€ä¸éªŒè¯è„šæœ¬ä¸­çš„å˜é‡åå®Œå…¨ä¸€è‡´ï¼š
```ini
# .env.actionsï¼ˆæœ¬åœ°æ–‡ä»¶ï¼Œéœ€æ·»åŠ åˆ°.gitignoreï¼Œé¿å…æ³„éœ²ï¼‰
# 1. GitHubä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆPATï¼‰ï¼šéœ€å…·å¤‡repoå’Œactionsæƒé™
GITHUB_ACTIONS_TOKEN=ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
# 2. ç›®æ ‡ä»“åº“æ‰€åœ¨çš„ç»„ç»‡/ç”¨æˆ·åï¼ˆå¦‚ä»“åº“åœ°å€æ˜¯https://github.com/my-org/project-deployï¼Œåˆ™å¡«my-orgï¼‰
GITHUB_ORG=my-org
```


## ä¸‰ã€æ–‡ä»¶è¯´æ˜ä¸ä½¿ç”¨æ³¨æ„äº‹é¡¹
1. **æ–‡ä»¶è·¯å¾„ä¸¥æ ¼åŒ¹é…**  
   - å·¥ä½œæµæ–‡ä»¶å¿…é¡»æ”¾åœ¨ä»“åº“çš„ `.github/workflows/` ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åå›ºå®šä¸º `deployment-status.yml`ï¼ˆä¸éªŒè¯è„šæœ¬ä¸­çš„ç›®æ ‡ä¸€è‡´ï¼‰ã€‚  
   - æœ¬åœ° `.env.actions` å¿…é¡»ä¸éªŒè¯è„šæœ¬ï¼ˆ`GitHub_Actions_Deployment_Verifier.py`ï¼‰åŒçº§ç›®å½•ã€‚

2. **GitHubä»¤ç‰Œæƒé™**  
   ç”Ÿæˆ `GITHUB_ACTIONS_TOKEN` æ—¶ï¼Œéœ€å‹¾é€‰ä»¥ä¸‹æƒé™ï¼ˆå¦åˆ™å·¥ä½œæµ/APIè°ƒç”¨ä¼šå¤±è´¥ï¼‰ï¼š  
   - `repo` â†’ å…¨é€‰ï¼ˆè®¿é—®ä»“åº“ã€Issueã€æäº¤ï¼‰ï¼›  
   - `actions` â†’ å…¨é€‰ï¼ˆè®¿é—®å·¥ä½œæµè¿è¡Œè®°å½•ï¼‰ã€‚  
   ä»¤ç‰Œç”Ÿæˆè·¯å¾„ï¼šGitHubè´¦å· â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Generate new tokenã€‚

3. **è§¦å‘å·¥ä½œæµ**  
   æäº¤ä¸Šè¿°æ–‡ä»¶åˆ° `project-deploy` ä»“åº“çš„ `main` åˆ†æ”¯åï¼Œå·¥ä½œæµä¼šè‡ªåŠ¨è§¦å‘ï¼›ä¹Ÿå¯åœ¨GitHubä»“åº“çš„ã€ŒActionsã€é¡µé¢æ‰‹åŠ¨è§¦å‘ï¼ˆç‚¹å‡»ã€ŒRun workflowã€ï¼‰ï¼Œç¡®ä¿å·¥ä½œæµæœ‰è‡³å°‘1æ¬¡æˆåŠŸè¿è¡Œè®°å½•ï¼ˆéªŒè¯è„šæœ¬éœ€æ ¡éªŒæˆåŠŸçš„å·¥ä½œæµï¼‰ã€‚


å®Œæˆä»¥ä¸Šæ–‡ä»¶é…ç½®åï¼Œè¿è¡ŒéªŒè¯è„šæœ¬ï¼ˆ`python GitHub_Actions_Deployment_Verifier.py`ï¼‰å³å¯é€šè¿‡æ‰€æœ‰æ ¡éªŒæ­¥éª¤ã€‚
